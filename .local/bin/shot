#!/data/data/com.termux/files/usr/bin/env bash
SAVE_DIR=/sdcard/Pictures/Screenshots
ORI_DIR=ORI

mkdir -p $SAVE_DIR/$ORI_DIR

[ $1 ] && sec=$1 || sec=5

{
	clear
	echo -e "\e[94m[!] screenshot will be taken in ${1}s ..."
	echo -e "\e[0m"

	{
		sleep $sec &&
			SAVE_NAME=$(echo -e "Screenshot-$(date +'%d-%m-%Y_%r').png"|sed 's/://g;s/ //g') &&
			sudo screencap -p $SAVE_DIR/$SAVE_NAME
		{
			A=$(termux-dialog confirm -i \
"Screenshot has successfully taken.

Now prettifying using imagemagick.

Please wait a moment ..." | jq '.text')

			[[ $A == '"no"' ]] && B=$(termux-dialog \
				confirm \
				-i "Cancel Conversion now?" | jq '.text')

			[[ $B == '"yes"' ]] && termux-dialog confirm \
			-i "Conversion Aborted." && pkill bash &&
			pkill convert
		} &

	  sleep 0.1

		bash \
			$HOME/.scripts/shot-magick \
			$SAVE_DIR/$SAVE_NAME \
			-r -c

		mv $SAVE_DIR/$SAVE_NAME $SAVE_DIR/$ORI_DIR

	} >/dev/null

	SAVE_NAME="$(echo $SAVE_NAME|sed 's/.png$//')_ShotMg.png"

	A=$(termux-dialog confirm \
		-t "Screenshot saved!" \
		-i "Your screenshot has been saved in:

$SAVE_DIR/${SAVE_NAME}

Open it now?" |
		jq '.text')

	[[ $A == '"yes"' ]] && xdg-open "$SAVE_DIR/$SAVE_NAME"
} &

